// Generated by CoffeeScript 1.5.0
(function() {
  var $;

  $ = jQuery;

  (function() {
    var ajax, pendingRequests;
    ajax = $.ajax;
    pendingRequests = {};
    return $.ajax = function(settings) {
      var port;
      settings = $.extend(settings, $.extend({}, $.ajaxSettings, settings));
      port = settings.port;
      if ('abort' === settings.mode) {
        if (pendingRequests[port]) {
          pendingRequests[port].abort();
        }
        return (pendingRequests[port] = ajax.apply(this, arguments));
      }
      return ajax.apply(this, arguments);
    };
  })();

  (function() {
    var callback, events;
    events = {
      focus: 'focusin',
      blur: 'focusout'
    };
    callback = function(original, fix) {
      return $.event.special[fix] = {
        setup: function() {
          if ($.browser.msie) {
            return false;
          }
          return this.addEventListener(original, $.event.special[fix].handler, true);
        },
        teardown: function() {
          if ($.browser.msie) {
            return false;
          }
          return this.removeEventListener(original, $.event.special[fix].handler, true);
        },
        handler: function(e) {
          arguments[0] = $.event.fix(e);
          arguments[0].type = fix;
          return $.event.handle.apply(this, arguments);
        }
      };
    };
    $.each(events, callback);
    return $.extend($.fn, {
      delegate: function(type, delegate, handler) {
        return this.bind(type, function(event) {
          var target;
          target = $(event.target);
          if (target.is(delegate)) {
            return handler.apply(target, arguments);
          }
        });
      },
      triggerEvent: function(type, target) {
        return this.triggerHandler(type, [
          $.event.fix({
            type: type,
            target: target
          })
        ]);
      }
    });
  })();

  window.user_nl = (function() {
    var default_params, _sendible_params;
    _sendible_params = {};
    $(function() {
      return $('#snd_form').validate({
        rules: {
          first_name: {
            required: true,
            minlength: 2
          },
          last_name: {
            required: true
          },
          email: {
            required: true,
            email: true
          },
          birthday: {
            required: true
          },
          birthmonth: {
            required: true
          },
          birthyear: {
            required: true
          }
        },
        messages: {
          first_name: {
            required: _sendible_params.labels.validate.first_name.required,
            minlength: jQuery.format(_sendible_params.labels.validate.first_name.minlength)
          },
          last_name: {
            required: _sendible_params.labels.validate.last_name.required,
            minlength: jQuery.format(_sendible_params.labels.validate.last_name.minlength)
          },
          email: {
            required: _sendible_params.labels.validate.email.required,
            email: _sendible_params.labels.validate.email.email
          },
          birthday: {
            required: _sendible_params.labels.validate.birthday.required
          },
          birthmonth: {
            required: _sendible_params.labels.validate.birthmonth.required
          },
          birthyear: {
            required: _sendible_params.labels.validate.birthyear.required
          }
        },
        errorLabelContainer: '#snd_errors'
      });
    });
    default_params = {
      labels: {
        first_name: 'First name',
        last_name: 'Last name',
        email: 'E-mail',
        gender: 'Gender',
        company: 'Company',
        occupation: 'Occupation',
        telephone: 'Telephone',
        mobile: 'Mobile',
        fax: 'Fax',
        address1: 'Address 1',
        address2: 'Address 2',
        city: 'City',
        country: 'Country',
        state: 'State',
        zipcode: 'Zip/Postcode',
        months: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
        validate: {
          first_name: {
            required: 'Please enter your first name.',
            minlength: 'Enter at least {0} characters.'
          },
          last_name: {
            required: 'Please enter your last name.',
            minlength: 'Enter at least {0} characters.'
          },
          email: {
            required: 'Please enter your email.',
            email: 'Please enter a valid email address.'
          },
          birthday: {
            required: 'Please select your birthday.'
          },
          birthmonth: {
            required: 'Please select your birthday month.'
          },
          birthyear: {
            required: 'Please select your birthday year.'
          }
        }
      }
    };
    return {
      new_contact_form: function(params) {
        var action, button_text, className, currentDate, currentMonth, currentYear, customParams, d, day, days, h, hour, i, m, minute, month, months, o, onchangeString, options, optionsSelect, trackingCode, y, year, years, yr, _i, _len, _ref;
        params = $.extend(null, default_params, params);
        _sendible_params = params;
        button_text = 'Submit';
        if (params.button_text != null) {
          button_text = params.button_text;
        }
        document.writeln('<style>');
        document.writeln('#snd_form #snd_tbl{float:left;width:100%}#snd_form #snd_row{float:left;display:block;width:100%;padding:5px}#snd_form #snd_label{float:left;width:30%}#snd_form #snd_data{float:left;width:70%}#snd_form #snd_data .prefs{width:100%}#snd_form #snd_data input{width:100%}#snd_form #snd_data .error{border:1px dotted red}#snd_form #snd_buttons{float:left;width:70%}#snd_form #snd_buttons input{width:120px}#snd_form #snd_errors{float:left;color:red;width:250px}#snd_form #snd_errors .error{float:none;display:block;clear:both;width:auto}');
        document.writeln('</style>');
        document.writeln('<div id="snd_tbl">');
        action = params.is_dev ? 'http://localhost:59608/Messaging.svc/CreateContact' : 'http://sendible.com/api/v1/widget-signup';
        document.writeln('<form id="snd_form" method="POST" action="' + action + '">');
        document.writeln('<div id="snd_row"><div id="snd_label">' + params.labels.first_name + '<span class="snd_required">*</span></div><div id="snd_data"><input type="text" name="first_name" class="required" title="Please enter your first name."/></div></div>');
        document.writeln('<div id="snd_row"><div id="snd_label">' + params.labels.last_name + '<span class="snd_required">*</span></div><div id="snd_data"><input type="text" name="last_name" class="required" title="Please enter your last name."/></div></div>');
        if (params.hide_email == null) {
          document.writeln('<div id="snd_row" ><div id="snd_label">' + params.labels.email + '<span class="snd_required">*</span></div><div id="snd_data"><input type="text" name="email" class="required email" title="Please enter your email."/></div></div>');
        }
        if (params.allow_duplicates == null) {
          params.allow_duplicates = 0;
        }
        document.writeln('<input type="hidden" name="success_redirect" value="' + params.success_url + '"/>');
        document.writeln('<input type="hidden" name="failure_redirect" value="' + params.failure_url + '"/>');
        document.writeln('<input type="hidden" name="location" value="' + window.location + '"/>');
        document.writeln('<input type="hidden" name="allow_duplicates" value="' + params.allow_duplicates + '"/>');
        if (params.show_gender) {
          document.writeln('<div id="snd_row"><div id="snd_label">' + params.labels.gender + '<span class="snd_required">*</span></div><div id="snd_data"><select name="gender" title="Please select your gender." class="required"><option value=""></option><option value="male">Male</option><option value="female">Female</option></select></div></div>');
        }
        if (params.show_company) {
          document.writeln('<div id="snd_row"><div id="snd_label">' + params.labels.company + '</div><div id="snd_data"><input type="text" name="company" title="Please enter your company name.(optional)"/></div></div>');
        }
        if (params.show_occupation) {
          document.writeln('<div id="snd_row"><div id="snd_label">' + params.labels.occupation + '</div id="snd_data"><div id="snd_data"><input type="text" name="occupation" title="Please enter your occupation.(optional)"/></div></div>');
        }
        if (params.show_telephone) {
          document.writeln('<div id="snd_row"><div id="snd_label">' + params.labels.telephone + '</div id="snd_data"><div id="snd_data"><input type="text" name="telephone" title="Please enter your home/work landline number.(optional)"/></div></div>');
        }
        if (params.show_mobile) {
          document.writeln('<div id="snd_row"><div id="snd_label">' + params.labels.mobile + '</div><div id="snd_data"><input type="text" name="mobile" title="Please enter your mobile number. Include country prefix. e.g. +1, +44 etc.(optional)"/></div></div>');
        }
        if (params.show_fax) {
          document.writeln('<div id="snd_row" ><div id="snd_label">' + params.labels.fax + '</div><div id="snd_data"><input type="text" name="fax" title="Please enter your fax number. (optional)"/></div></div>');
        }
        if (params.show_address) {
          document.writeln('<div id="snd_row" ><div id="snd_label">' + params.labels.address1 + '</div><div id="snd_data"><input type="text" name="address1" title="Please enter your address. (optional)"/></div></div>');
          document.writeln('<div id="snd_row"><div id="snd_label">' + params.labels.address2 + '</div><div id="snd_data"><input type="text" name="address2" /></div></div>');
          document.writeln('<div id="snd_row"><div id="snd_label">' + params.labels.city + '</div><div id="snd_data"><input type="text" name="city" /></div></div>');
          document.writeln('<div id="snd_row"><div id="snd_label">' + params.labels.country + '</div><div id="snd_data"><input type="text" name="country" /></div></div>');
          document.writeln('<div id="snd_row"><div id="snd_label">' + params.labels.state + '</div><div id="snd_data"><input type="text" name="state" maxlength="2" /></div></div>');
          if ((params.show_zip == null) || params.show_zip === false) {
            params.show_zip = true;
          }
        }
        if ((params.show_zip != null) && params.show_zip) {
          document.writeln('<div id="snd_row"><div id="snd_label">' + params.labels.zipcode + '</div><div id="snd_data"><input type="text" name="postcode" /></div></div>');
        }
        if (params.show_birthday) {
          days = '';
          years = '';
          i = 1;
          while (i <= 31) {
            days += '<option value="' + i + '">' + i + '</option>';
            i++;
          }
          year = new Date().getFullYear();
          i = year;
          while (i > year - 100) {
            years += '<option value="' + i + '">' + i + '</option>';
            i--;
          }
          months = '<option value="1">' + params.labels.months[0] + '</option><option value="2">' + params.labels.months[1] + '</option><option value="3">March</option><option value="4">April</option><option value="5">May</option><option value="6">June</option><option value="7">July</option><option value="8">August</option><option value="9">September</option><option value="10">October</option><option value="11">November</option><option value="12">December</option>';
          document.writeln('<div id="snd_row" ><div id="snd_label">Birthday*</div><div id="snd_data"><select name="birthday" id="birthday"><option value="">Day</option>' + days + '</select><select name="birthmonth" id="birthmonth"><option value="">Month</option>' + months + '</select><select name="birthyear" id="birthyear"><option value="">Year</option>' + years + '</select></div></div>');
        }
        if (params.custom != null) {
          customParams = params.custom;
          document.writeln('<input type="hidden" name="custom_field_count" value="' + customParams.length + '"/>');
          i = 0;
          while (i < customParams.length) {
            className = '';
            if ((customParams[i].required != null) && customParams[i].required === true) {
              className = 'required';
            }
            if (customParams[i].field_title == null) {
              customParams[i].field_title = customParams[i].field_name;
            }
            if (className === 'required') {
              document.writeln('<div id="snd_row" ><div id="snd_label">' + decodeURIComponent(customParams[i].field_title) + '<span class="snd_required">*</span></div><div id="snd_data">');
            } else {
              document.writeln('<div id="snd_row" ><div id="snd_label">' + decodeURIComponent(customParams[i].field_title) + '</div><div id="snd_data">');
            }
            document.writeln('<input type="hidden" name="custom_' + i + '_name" value="' + customParams[i].field_name.toLowerCase() + '"/>');
            document.writeln('<input type="hidden" name="custom_' + i + '_type" value="' + customParams[i].field_type.toLowerCase() + '"/>');
            if (customParams[i].field_type === 'password') {
              document.writeln('<input type="password" class="' + className + '" name="' + customParams[i].field_name.toLowerCase() + '" title="Please enter your ' + customParams[i].field_title.toLowerCase() + '. "/>');
            } else if (customParams[i].field_type === 'date') {
              document.writeln('<input type="hidden" name="' + customParams[i].field_name.toLowerCase() + '" id="custom_' + i + '"  ">');
              onchangeString = 'jQuery(';
              document.writeln('<select id="custom_' + i + '_field1" class="' + className + '" title="Please select the ' + customParams[i].field_title.toLowerCase() + '. " onchange="' + onchangeString + '">');
              document.writeln('<option value=""></option>');
              currentDate = new Date().getDate();
              d = 1;
              while (d <= 31) {
                day = d.toString();
                document.writeln('<option value="' + day + '" ' + (currentDate === d ? 'selected="selected"' : '') + '>' + day + '</option>');
                d++;
              }
              document.writeln('</select>');
              document.writeln('<select title="Please select the ' + customParams[i].field_title.toLowerCase() + '. " id="custom_' + i + '_field2" class="' + className + '" onchange="' + onchangeString + '">');
              document.writeln('<option value=""></option>');
              currentMonth = new Date().getMonth();
              _ref = params.labels.months;
              for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
                month = _ref[i];
                document.writeln('<option value="' + month + '" ' + (currentMonth === i ? 'selected="selected"' : '') + '>' + month + '</option>');
              }
              document.writeln('</select>');
              document.writeln('<select title="Please select the ' + customParams[i].field_title.toLowerCase() + '. " id="custom_' + i + '_field3" class="' + className + '" onchange="' + onchangeString + '">');
              document.writeln('<option value=""></option>');
              currentYear = new Date().getFullYear();
              y = currentYear - 100;
              while (y < currentYear + 100) {
                yr = y.toString();
                document.writeln('<option value="' + yr + '" ' + (currentYear === y ? 'selected="selected"' : '') + '>' + yr + '</option>');
                y++;
              }
              document.writeln('</select>');
            } else if (customParams[i].field_type === 'time') {
              document.writeln('<input type="hidden" name="' + customParams[i].field_name.toLowerCase() + '" id="custom_' + i + '"  ">');
              onchangeString = 'jQuery(';
              document.writeln('<select title="Please select the ' + customParams[i].field_title.toLowerCase() + '. " id="custom_' + i + '_field1" class="' + className + '" onchange="' + onchangeString + '">');
              document.writeln('<option value=""></option>');
              h = 1;
              while (h <= 12) {
                hour = h.toString();
                if (h < 10) {
                  hour = '0' + hour;
                }
                document.writeln('<option value="' + hour + '">' + hour + '</option>');
                h++;
              }
              document.writeln('</select>');
              document.writeln(':');
              document.writeln('<select title="Please select the ' + customParams[i].field_title.toLowerCase() + '. " id="custom_' + i + '_field2" class="' + className + '" onchange="' + onchangeString + '">');
              document.writeln('<option value=""></option>');
              m = 0;
              while (m < 60) {
                minute = m.toString();
                if (m < 10) {
                  minute = '0' + minute;
                }
                document.writeln('<option value="' + minute + '">' + minute + '</option>');
                m++;
              }
              document.writeln('</select>');
              document.writeln('<select title="Please select the ' + customParams[i].field_title.toLowerCase() + '. " id="custom_' + i + '_field3" class="' + className + '" onchange="' + onchangeString + '"><option value=""></option><option value="AM">AM</option><option value="PM">PM</option></select>');
            } else if (customParams[i].field_type === 'url') {
              document.writeln('<input type="text" class="' + className + ' url" name="' + customParams[i].field_name.toLowerCase() + '" title="Please enter a valid ' + customParams[i].field_title.toLowerCase() + ' URL. " value="YYYY-mm-dd"/>');
            } else if (customParams[i].field_type === 'numeric') {
              document.writeln('<input type="text" class="' + className + ' number" name="' + customParams[i].field_name.toLowerCase() + '" title="Please enter a valid ' + customParams[i].field_title.toLowerCase() + '. " value=""/>');
            } else if (customParams[i].field_type === 'list') {
              if ((customParams[i].field_options != null) && customParams[i].field_options !== '') {
                customParams[i].field_options = decodeURIComponent(customParams[i].field_options);
                options = customParams[i].field_options.split('|');
                optionsSelect = '<select class="' + className + '" name="' + customParams[i].field_name.toLowerCase() + '" title="Please select your ' + customParams[i].field_title.toLowerCase() + '. ">';
                o = 0;
                while (o < options.length) {
                  optionsSelect = optionsSelect + '<option value="' + options[o] + '">' + options[o] + '</option>';
                  o++;
                }
                optionsSelect = optionsSelect + '</select>';
                document.writeln(optionsSelect);
              }
            } else if (customParams[i].field_type === 'textarea') {
              document.writeln('<textarea class="' + className + '" name="' + customParams[i].field_name.toLowerCase() + '" title="Please enter your ' + customParams[i].field_title.toLowerCase() + '. "></textarea>');
            } else {
              document.writeln('<input type="text" class="' + className + '" name="' + customParams[i].field_name.toLowerCase() + '" title="Please enter your ' + customParams[i].field_title.toLowerCase() + '. "/>');
            }
            document.writeln('</div></div>');
            i++;
          }
        }
        if (params.show_mobile) {
          document.writeln('<div id="snd_row" ><div id="snd_label">Preferred Contact Method</div><div id="snd_data"><select class="prefs" name="preference" id="preference"><option value="Email">Email</option><option value="SMS">SMS</option></select></div></div>');
        }
        if (params.group_id == null) {
          params.group_id = -1;
        }
        if (params.notify_group_id == null) {
          params.notify_group_id = -1;
        }
        if (params.notify_message == null) {
          params.notify_message = '';
        }
        if (params.notify_emails == null) {
          params.notify_emails === '';
        }
        document.writeln('<div id="snd_row" style="display:none;"><input type="hidden" name="notify_group_id" value="' + params.notify_group_id.toString() + '" /></div>');
        document.writeln('<div id="snd_row" style="display:none;"><input type="hidden" name="notify_message" value="' + params.notify_message.toString() + '" /></div>');
        if (params.notify_emails == null) {
          document.writeln('<div id="snd_row" style="display:none;"><input type="hidden" name="notify_emails" value="" /></div>');
        } else {
          document.writeln('<div id="snd_row" style="display:none;"><input type="hidden" name="notify_emails" value="' + params.notify_emails.toString() + '" /></div>');
        }
        document.writeln('<div id="snd_row" style="display:none;"><input type="hidden" name="group_id" value="' + params.group_id.toString() + '" /></div>');
        document.writeln('<div id="snd_row" style="display:none;"><input type="hidden" name="api_key" value="' + params.api_key + '" /></div>');
        document.writeln('<div id="snd_row" class="snd_btn_row" ><div id="snd_label">&nbsp;</div><div id="snd_buttons"><input type="submit"  name="snd_submit" value="' + button_text + '" /></div></div>');
        if (params.is_wl !== true) {
          trackingCode = '';
          if (params.tracking_code != null) {
            trackingCode = '?f=' + params.tracking_code;
          }
        }
        document.writeln('<div id="snd_row" ><div id="snd_label">&nbsp;</div><div id="snd_errors"></div></div>');
        document.writeln('</form>');
        return document.writeln('</div>');
      }
    };
  })();

}).call(this);
